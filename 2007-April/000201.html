<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<HTML>
 <HEAD>
   <TITLE> r217 - in trunk: . kernel/2.6/drivers/net/can	kernel/2.6/include/linux/can kernel/2.6/net/can
   </TITLE>
   <LINK REL="Index" HREF="http://lists.berlios.de/pipermail/socketcan-commit/2007-April/index.html" >
   <LINK REL="made" HREF="mailto:socketcan-commit%40lists.berlios.de?Subject=Re%3A%20r217%20-%20in%20trunk%3A%20.%20kernel/2.6/drivers/net/can%0A%09kernel/2.6/include/linux/can%20kernel/2.6/net/can&In-Reply-To=%3C200704181405.l3IE5dLF020511%40sheep.berlios.de%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <style type="text/css">
       pre {
           white-space: pre-wrap;       /* css-2.1, curent FF, Opera, Safari */
           }
   </style>
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="000200.html">
   <LINK REL="Next"  HREF="000202.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>r217 - in trunk: . kernel/2.6/drivers/net/can	kernel/2.6/include/linux/can kernel/2.6/net/can</H1>
    <B>thuermann at mail.berlios.de</B> 
    <A HREF="mailto:socketcan-commit%40lists.berlios.de?Subject=Re%3A%20r217%20-%20in%20trunk%3A%20.%20kernel/2.6/drivers/net/can%0A%09kernel/2.6/include/linux/can%20kernel/2.6/net/can&In-Reply-To=%3C200704181405.l3IE5dLF020511%40sheep.berlios.de%3E"
       TITLE="r217 - in trunk: . kernel/2.6/drivers/net/can	kernel/2.6/include/linux/can kernel/2.6/net/can">thuermann at mail.berlios.de
       </A><BR>
    <I>Wed Apr 18 16:05:39 CEST 2007</I>
    <P><UL>
        <LI>Previous message: <A HREF="000200.html">r216 - trunk/kernel/2.6/net/can
</A></li>
        <LI>Next message: <A HREF="000202.html">r218 - trunk/kernel/2.6/drivers/net/can
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#201">[ date ]</a>
              <a href="thread.html#201">[ thread ]</a>
              <a href="subject.html#201">[ subject ]</a>
              <a href="author.html#201">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>Author: thuermann
Date: 2007-04-18 16:05:21 +0200 (Wed, 18 Apr 2007)
New Revision: 217

Modified:
   trunk/FILES-2.6
   trunk/kernel/2.6/drivers/net/can/slcan.c
   trunk/kernel/2.6/drivers/net/can/vcan.c
   trunk/kernel/2.6/include/linux/can/core.h
   trunk/kernel/2.6/include/linux/can/version.h
   trunk/kernel/2.6/net/can/af_can.c
   trunk/kernel/2.6/net/can/bcm.c
   trunk/kernel/2.6/net/can/proc.c
   trunk/kernel/2.6/net/can/raw.c
   trunk/mkpatch
Log:
Remove everything from version.h except definition of RCSID().
Rename macro VERSION to CAN_VERSION, now defined in core.h.
Add macro CAN_ABI_VERSION.
Don't include version.h in kernel patches and delete usage of RCSID()
from all files generated by mkpatch.


Modified: trunk/FILES-2.6
===================================================================
--- trunk/FILES-2.6	2007-04-18 13:49:51 UTC (rev 216)
+++ trunk/FILES-2.6	2007-04-18 14:05:21 UTC (rev 217)
@@ -7,7 +7,6 @@
 kernel/2.6/net/can/bcm.c
 kernel/2.6/include/linux/can.h
 kernel/2.6/include/linux/can/core.h
-kernel/2.6/include/linux/can/version.h
 kernel/2.6/include/linux/can/error.h
 kernel/2.6/include/linux/can/raw.h
 kernel/2.6/include/linux/can/bcm.h

Modified: trunk/kernel/2.6/drivers/net/can/slcan.c
===================================================================
--- trunk/kernel/2.6/drivers/net/can/slcan.c	2007-04-18 13:49:51 UTC (rev 216)
+++ trunk/kernel/2.6/drivers/net/can/slcan.c	2007-04-18 14:05:21 UTC (rev 217)
@@ -81,8 +81,8 @@
 
 RCSID(&quot;$Id$&quot;);
 
-static __initdata const char banner[] = KERN_INFO
-			&quot;CAN: serial line CAN interface &quot; VERSION &quot;\n&quot;; 
+static __initdata const char banner[] =
+	KERN_INFO &quot;CAN: serial line CAN interface &quot; CAN_VERSION &quot;\n&quot;;
 
 MODULE_ALIAS_LDISC(N_SLCAN);
 MODULE_DESCRIPTION(&quot;serial line CAN interface&quot;);

Modified: trunk/kernel/2.6/drivers/net/can/vcan.c
===================================================================
--- trunk/kernel/2.6/drivers/net/can/vcan.c	2007-04-18 13:49:51 UTC (rev 216)
+++ trunk/kernel/2.6/drivers/net/can/vcan.c	2007-04-18 14:05:21 UTC (rev 217)
@@ -54,8 +54,8 @@
 
 RCSID(&quot;$Id$&quot;);
 
-static __initdata const char banner[] = KERN_INFO &quot;CAN: virtual CAN &quot;
-					&quot;interface &quot; VERSION &quot;\n&quot;; 
+static __initdata const char banner[] =
+	KERN_INFO &quot;CAN: virtual CAN interface &quot; CAN_VERSION &quot;\n&quot;; 
 
 MODULE_DESCRIPTION(&quot;virtual CAN interface&quot;);
 MODULE_LICENSE(&quot;Dual BSD/GPL&quot;);

Modified: trunk/kernel/2.6/include/linux/can/core.h
===================================================================
--- trunk/kernel/2.6/include/linux/can/core.h	2007-04-18 13:49:51 UTC (rev 216)
+++ trunk/kernel/2.6/include/linux/can/core.h	2007-04-18 14:05:21 UTC (rev 217)
@@ -21,6 +21,12 @@
 #include &lt;linux/skbuff.h&gt;
 #include &lt;linux/netdevice.h&gt;
 
+
+#define CAN_VERSION &quot;2.0.0-pre6&quot;
+
+/* increment this number each time you change some user-space interface */
+#define CAN_ABI_VERSION 8
+
 #define DNAME(dev) ((dev) ? (dev)-&gt;name : &quot;any&quot;)
 
 #define CAN_PROC_DIR &quot;net/can&quot; /* /proc/... */

Modified: trunk/kernel/2.6/include/linux/can/version.h
===================================================================
--- trunk/kernel/2.6/include/linux/can/version.h	2007-04-18 13:49:51 UTC (rev 216)
+++ trunk/kernel/2.6/include/linux/can/version.h	2007-04-18 14:05:21 UTC (rev 217)
@@ -19,22 +19,4 @@
 
 RCSID(&quot;$Id$&quot;);
 
-#define MAJORVERSION 2
-#define MINORVERSION 0
-#define PATCHLEVEL   0
-#define EXTRAVERSION &quot;-pre6&quot;
-
-#define LLCF_VERSION_CODE (((MAJORVERSION) &lt;&lt; 16) + ((MINORVERSION) &lt;&lt; 8) \
-				+ (PATCHLEVEL))
-
-/* stringification:  these are the usual macros to stringify with macro
-   expansion.   The str() macro does the expansion, the xstr() macro is
-   for the actual stringification.
-*/
-#define str(arg) xstr(arg)
-#define xstr(arg) #arg
-
-#define VERSION str(MAJORVERSION) &quot;.&quot; str(MINORVERSION) &quot;.&quot; str(PATCHLEVEL) \
-	EXTRAVERSION
-
 #endif /* CAN_VERSION_H */

Modified: trunk/kernel/2.6/net/can/af_can.c
===================================================================
--- trunk/kernel/2.6/net/can/af_can.c	2007-04-18 13:49:51 UTC (rev 216)
+++ trunk/kernel/2.6/net/can/af_can.c	2007-04-18 14:05:21 UTC (rev 217)
@@ -71,8 +71,8 @@
 RCSID(&quot;$Id$&quot;);
 
 #define IDENT &quot;af_can&quot;
-static __initdata const char banner[] = KERN_INFO &quot;CAN: Controller Area &quot;
-					&quot;Network PF_CAN core &quot; VERSION &quot;\n&quot;; 
+static __initdata const char banner[] =
+	KERN_INFO &quot;CAN: Controller Area Network PF_CAN core &quot; CAN_VERSION &quot;\n&quot;;
 
 MODULE_DESCRIPTION(&quot;Controller Area Network PF_CAN core&quot;);
 MODULE_LICENSE(&quot;Dual BSD/GPL&quot;);

Modified: trunk/kernel/2.6/net/can/bcm.c
===================================================================
--- trunk/kernel/2.6/net/can/bcm.c	2007-04-18 13:49:51 UTC (rev 216)
+++ trunk/kernel/2.6/net/can/bcm.c	2007-04-18 14:05:21 UTC (rev 217)
@@ -83,7 +83,7 @@
 
 #define IDENT &quot;bcm&quot;
 static __initdata const char banner[] = KERN_INFO
-	&quot;CAN: broadcast manager (bcm) socket protocol &quot; VERSION &quot;\n&quot;; 
+	&quot;CAN: broadcast manager (bcm) socket protocol &quot; CAN_VERSION &quot;\n&quot;;
 
 MODULE_DESCRIPTION(&quot;PF_CAN bcm sockets&quot;);
 MODULE_LICENSE(&quot;Dual BSD/GPL&quot;);

Modified: trunk/kernel/2.6/net/can/proc.c
===================================================================
--- trunk/kernel/2.6/net/can/proc.c	2007-04-18 13:49:51 UTC (rev 216)
+++ trunk/kernel/2.6/net/can/proc.c	2007-04-18 14:05:21 UTC (rev 217)
@@ -340,8 +340,8 @@
 	int len = 0;
 
 	len += snprintf(page + len, PAGE_SIZE - len,
-			&quot;%06X [ Volkswagen Group - Low Level CAN Framework&quot;
-			&quot; (LLCF) v%s ]\n&quot;, LLCF_VERSION_CODE, VERSION);
+			&quot;CAN version %s, ABI version %d&quot;,
+			CAN_VERSION, CAN_ABI_VERSION);
 	*eof = 1;
 	return len;
 }

Modified: trunk/kernel/2.6/net/can/raw.c
===================================================================
--- trunk/kernel/2.6/net/can/raw.c	2007-04-18 13:49:51 UTC (rev 216)
+++ trunk/kernel/2.6/net/can/raw.c	2007-04-18 14:05:21 UTC (rev 217)
@@ -61,8 +61,8 @@
 RCSID(&quot;$Id$&quot;);
 
 #define IDENT &quot;raw&quot;
-static __initdata const char banner[] = KERN_INFO &quot;CAN: raw socket protocol&quot;
-					&quot; &quot; VERSION &quot;\n&quot;; 
+static __initdata const char banner[] =
+	KERN_INFO &quot;CAN: raw socket protocol &quot; CAN_VERSION &quot;\n&quot;;
 
 MODULE_DESCRIPTION(&quot;PF_CAN raw sockets&quot;);
 MODULE_LICENSE(&quot;Dual BSD/GPL&quot;);

Modified: trunk/mkpatch
===================================================================
--- trunk/mkpatch	2007-04-18 13:49:51 UTC (rev 216)
+++ trunk/mkpatch	2007-04-18 14:05:21 UTC (rev 217)
@@ -5,6 +5,8 @@
 # Generate a kernel patch to add socketcan to a kernel src tree.
 # The list of files to be added is read from stdin.
 
+use POSIX qw(strftime);
+
 $version = shift;
 
 if (-r &quot;patches/$version.diff&quot;) {
@@ -43,15 +45,29 @@
     open file, &quot;./kv $version $file |&quot; || die &quot;open $file\n&quot;;
     @lines = &lt;file&gt;;
     $count = $#lines + 1;
-    use POSIX qw(strftime);
     $mtime = (stat($file))[9];
     $ts = strftime &quot;%F %T&quot;, gmtime((stat($file))[9]);
 
+    for $i (0..$#lines) {
+	if ($lines[$i] =~ /include.*linux\/can\/version\.h/) {
+	    undef($lines[$i]);
+	    $count--;
+	}
+	if ($lines[$i] =~ /RCSID/) {
+	    undef($lines[$i]);
+	    $count--;
+	    while ($lines[++$i] eq &quot;\n&quot;) {
+		undef($lines[$i]);
+		$count--;
+	    }
+	}
+    }
+
     print &quot;--- a/$name 1970-01-01 00:00:00\n&quot;;
     print &quot;+++ b/$name $ts\n&quot;;
     print &quot;@@ -0,0 +1,$count @@\n&quot;;
     for (@lines) {
-	print &quot;+$_&quot;;
+	print &quot;+$_&quot; if (defined($_));
     }
     close file;
 }


</PRE>

<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="000200.html">r216 - trunk/kernel/2.6/net/can
</A></li>
	<LI>Next message: <A HREF="000202.html">r218 - trunk/kernel/2.6/drivers/net/can
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#201">[ date ]</a>
              <a href="thread.html#201">[ thread ]</a>
              <a href="subject.html#201">[ subject ]</a>
              <a href="author.html#201">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="https://lists.berlios.de/mailman/listinfo/socketcan-commit">More information about the Socketcan-commit
mailing list</a><br>
</body></html>
